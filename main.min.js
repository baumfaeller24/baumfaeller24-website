// Optimized and minified JavaScript for Baumfäller24 - Production Ready
!function(){"use strict";function e(){const e=document.getElementById("header"),t=document.getElementById("nav-toggle"),n=document.getElementById("nav-menu");let o=0;window.addEventListener("scroll",(function(){const t=window.pageYOffset||document.documentElement.scrollTop;t>100?e.classList.add("scrolled"):e.classList.remove("scrolled"),t>o&&t>200?e.style.transform="translateY(-100%)":e.style.transform="translateY(0)",o=t}));const r=document.querySelectorAll(".nav-dropdown");r.forEach((e=>{const t=e.querySelector(".nav-dropdown-menu");let n;e.addEventListener("mouseenter",(function(){clearTimeout(n),t.style.display="block",setTimeout((()=>{t.classList.add("show")}),10)})),e.addEventListener("mouseleave",(function(){t.classList.remove("show"),n=setTimeout((()=>{t.style.display="none"}),300)}))}))}function t(){const e=document.getElementById("nav-toggle"),t=document.getElementById("nav-menu"),n=document.body;if(e&&t){e.addEventListener("click",(function(){e.classList.toggle("active"),t.classList.toggle("active"),n.classList.toggle("menu-open");const o=e.querySelectorAll(".nav-toggle-line");e.classList.contains("active")?(o[0].style.transform="rotate(45deg) translate(5px, 5px)",o[1].style.opacity="0",o[2].style.transform="rotate(-45deg) translate(7px, -6px)"):(o[0].style.transform="none",o[1].style.opacity="1",o[2].style.transform="none")})),document.addEventListener("click",(function(o){if(!e.contains(o.target)&&!t.contains(o.target)){e.classList.remove("active"),t.classList.remove("active"),n.classList.remove("menu-open");const o=e.querySelectorAll(".nav-toggle-line");o[0].style.transform="none",o[1].style.opacity="1",o[2].style.transform="none"}}));const o=t.querySelectorAll("a");o.forEach((o=>{o.addEventListener("click",(function(){e.classList.remove("active"),t.classList.remove("active"),n.classList.remove("menu-open");const o=e.querySelectorAll(".nav-toggle-line");o[0].style.transform="none",o[1].style.opacity="1",o[2].style.transform="none"}))}))}}function n(){const e={threshold:.1,rootMargin:"0px 0px -50px 0px"},t=new IntersectionObserver((function(e){e.forEach((e=>{if(e.isIntersecting){e.target.classList.add("visible");if(e.target.classList.contains("stagger-parent")){const t=e.target.querySelectorAll(".stagger-child");t.forEach(((e,t)=>{setTimeout((()=>{e.classList.add("visible")}),100*t)}))}}}))}),e),n=document.querySelectorAll(".fade-in-up, .service-card, .problem-card, .testimonial-card, .knowledge-card, .why-item");n.forEach((e=>{e.classList.add("fade-in-up"),t.observe(e)}));const o=document.querySelectorAll(".services-grid, .problems-grid, .why-grid, .testimonials-grid, .knowledge-grid");o.forEach((e=>{e.classList.add("stagger-parent");const t=e.children;Array.from(t).forEach((e=>{e.classList.add("stagger-child")}))}))}function o(){const e=document.querySelectorAll('a[href^="#"]');e.forEach((e=>{e.addEventListener("click",(function(e){e.preventDefault();const t=this.getAttribute("href"),n=document.querySelector(t);if(n){const e=document.getElementById("header").offsetHeight,t=n.offsetTop-e-20;window.scrollTo({top:t,behavior:"smooth"}),history.pushState(null,null,t)}}))}))}function r(){const e=document.querySelectorAll("form");e.forEach((e=>{e.addEventListener("submit",(function(t){t.preventDefault();const n=new FormData(e),o=i(e);o&&a(e,n)}));const t=e.querySelectorAll("input, textarea, select");t.forEach((e=>{e.addEventListener("blur",(function(){s(this)})),e.addEventListener("input",(function(){c(this)}))}))}))}function i(e){let t=!0;const n=e.querySelectorAll("[required]");return n.forEach((e=>{s(e)||(t=!1)})),t}function s(e){const t=e.value.trim(),n=e.type,o=e.name;if(c(e),e.hasAttribute("required")&&!t)return l(e,"Dieses Feld ist erforderlich."),!1;if("email"===n&&t){if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t))return l(e,"Bitte geben Sie eine gültige E-Mail-Adresse ein."),!1}if("phone"===o&&t){if(!/^[\d\s\-\+\(\)]+$/.test(t)||t.length<10)return l(e,"Bitte geben Sie eine gültige Telefonnummer ein."),!1}if("plz"===o&&t){if(!/^\d{5}$/.test(t))return l(e,"Bitte geben Sie eine gültige PLZ ein (5 Ziffern)."),!1}return!0}function l(e,t){e.classList.add("error");const n=e.parentNode.querySelector(".field-error");n&&n.remove();const o=document.createElement("div");o.className="field-error",o.textContent=t,e.parentNode.appendChild(o)}function c(e){e.classList.remove("error");const t=e.parentNode.querySelector(".field-error");t&&t.remove()}function a(e,t){const n=e.querySelector('button[type="submit"], input[type="submit"]'),o=n.textContent;n.disabled=!0,n.textContent="Wird gesendet...",n.classList.add("loading"),setTimeout((()=>{n.textContent="Gesendet ✓",n.classList.remove("loading"),n.classList.add("success"),d("Vielen Dank! Wir haben Ihre Anfrage erhalten und melden uns binnen 24 Stunden bei Ihnen.","success"),e.reset(),u("form_submit",{form_name:e.getAttribute("name")||"contact_form",form_location:window.location.pathname}),setTimeout((()=>{n.disabled=!1,n.textContent=o,n.classList.remove("success")}),3e3)}),2e3)}function d(e,t="info"){const n=document.createElement("div");n.className=`notification notification-${t}`,n.innerHTML=`\n        <div class="notification-content">\n            <span class="notification-message">${e}</span>\n            <button class="notification-close" onclick="this.parentElement.parentElement.remove()">×</button>\n        </div>\n    `,document.body.appendChild(n),setTimeout((()=>{n.classList.add("show")}),100),setTimeout((()=>{n.classList.remove("show"),setTimeout((()=>{n.parentNode&&n.remove()}),300)}),5e3)}function u(e,t={}){void 0!==window.gtag&&gtag("event",e,t),void 0!==window.fbq&&fbq("track",e,t),console.log("Event tracked:",e,t)}function f(){u("page_view",{page_title:document.title,page_location:window.location.href});let e=0;window.addEventListener("scroll",(function(){const t=Math.round(window.scrollY/(document.body.scrollHeight-window.innerHeight)*100);t>e&&(e=t,e>=25&&e<50?u("scroll_depth",{depth:"25%"}):e>=50&&e<75?u("scroll_depth",{depth:"50%"}):e>=75&&e<90?u("scroll_depth",{depth:"75%"}):e>=90&&u("scroll_depth",{depth:"90%"}))}));const t=document.querySelectorAll(".btn-primary, .btn-emergency");t.forEach((e=>{e.addEventListener("click",(function(){u("cta_click",{cta_text:this.textContent.trim(),cta_location:this.closest("section")?.className||"unknown"})}))}));const n=document.querySelectorAll('a[href^="tel:"]');n.forEach((e=>{e.addEventListener("click",(function(){u("phone_click",{phone_number:this.getAttribute("href"),click_location:this.closest("section")?.className||"unknown"})}))}));const o=document.querySelectorAll('a[href^="http"]:not([href*="'+window.location.hostname+'"])');o.forEach((e=>{e.addEventListener("click",(function(){u("external_link_click",{link_url:this.href,link_text:this.textContent.trim()})}))}))}function m(e,t,n){let o;return function(){const r=this,i=arguments,s=function(){o=null,n||e.apply(r,i)},l=n&&!o;clearTimeout(o),o=setTimeout(s,t),l&&e.apply(r,i)}}function g(e,t){let n;return function(){const o=arguments,r=this;n||(e.apply(r,o),n=!0,setTimeout((()=>n=!1),t))}}function p(e){const t=e.replace(/\D/g,""),n=t.match(/^(\d{4})(\d{3})(\d{4})$/);return n?n[1]+" "+n[2]+" "+n[3]:e}function h(e){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(e)}function v(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");const t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))}function y(){const e=document.querySelectorAll("img[data-src]"),t=new IntersectionObserver(((e,n)=>{e.forEach((e=>{if(e.isIntersecting){const n=e.target;n.src=n.dataset.src,n.classList.remove("lazy"),t.unobserve(n)}}))}));e.forEach((e=>t.observe(e)))}function b(){const e=["/images/hero-baumkletterer-aktion.jpg","/images/logo-baumfaeller24.svg"];e.forEach((e=>{const t=document.createElement("link");t.rel="preload",t.as="image",t.href=e,document.head.appendChild(t)}))}document.addEventListener("DOMContentLoaded",(function(){e(),n(),o(),t(),r(),f()})),window.addEventListener("error",(function(e){console.error("JavaScript error:",e.error),u("javascript_error",{error_message:e.message,error_filename:e.filename,error_lineno:e.lineno})})),document.addEventListener("keydown",(function(e){"Escape"===e.key&&(document.querySelectorAll(".nav-dropdown-menu.show").forEach((e=>{e.classList.remove("show")})),document.getElementById("nav-toggle")?.classList.contains("active")&&document.getElementById("nav-toggle")?.click())})),document.addEventListener("DOMContentLoaded",(function(){y(),b()})),window.BaumfaellerApp={trackEvent:u,showNotification:d,formatCurrency:h,formatPhoneNumber:p,announceToScreenReader:function(e){const t=document.createElement("div");t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.className="sr-only",t.textContent=e,document.body.appendChild(t),setTimeout((()=>{document.body.removeChild(t)}),1e3)}}}();
